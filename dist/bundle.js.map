{"version":3,"sources":["webpack/bootstrap","c:/Users/xiexiaowei/Desktop/testExpressEs6/test4es6/apis\\admin.js","c:/Users/xiexiaowei/Desktop/testExpressEs6/test4es6/apis\\index.js","c:/Users/xiexiaowei/Desktop/testExpressEs6/test4es6/app.js","c:/Users/xiexiaowei/Desktop/testExpressEs6/test4es6/bin\\www.js","c:/Users/xiexiaowei/Desktop/testExpressEs6/test4es6/config\\passport.config.js","c:/Users/xiexiaowei/Desktop/testExpressEs6/test4es6/lib\\ret.class.js","c:/Users/xiexiaowei/Desktop/testExpressEs6/test4es6/models\\user.js","external \"body-parser\"","external \"connect-flash\"","external \"connect-mongo\"","external \"cookie-parser\"","external \"debug\"","external \"errorhandler\"","external \"express\"","external \"express-session\"","external \"express-validator\"","external \"http\"","external \"log4js\"","external \"method-override\"","external \"mongoose\"","external \"morgan\"","external \"multer\"","external \"passport\"","external \"passport-local\"","external \"path\"","external \"serve-favicon\""],"names":["express","require","router","Router","passport","post","authenticate","failureFlash","req","res","next","json","retClass","module","exports","admin","ensureAuthenticated","isAuthenticated","redirect","get","app","use","path","favicon","logger","cookieParser","bodyParser","session","flash","validator","MongoStore","mongoose","routes","methodOverride","multer","errorHandler","log4js","configure","appenders","console","type","menu","filename","replaceConsole","categories","default","level","getLogger","connectLogger","levels","INFO","urlencoded","extended","secret","resave","saveUninitialized","store","mongooseConnection","connection","cookie","maxAge","initialize","options","dotfiles","etag","extensions","index","setHeaders","stat","set","Date","now","static","join","__dirname","debug","http","port","normalizePort","process","env","PORT","server","createServer","listen","on","onError","onListening","val","parseInt","isNaN","error","syscall","bind","code","exit","addr","address","User","localStategy","Strategy","serializeUser","user","done","id","deserializeUser","findById","err","usernameField","passwordField","passReqToCallback","password","findOne","message","newUser","username","encryptPassword","save","result","validPassword","x","y","z","retCode","retMes","ret"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./bin/www.js\");\n","var express = require('express');\r\nvar router = express.Router();\r\nvar passport = require('../config/passport.config');\r\nimport retClass from '../lib/ret.class';\r\n\r\nrouter.post('/signup',\r\n    passport.authenticate('local.signup',{\r\n        failureFlash:true\r\n    }),function(req,res,next){\r\n        res.json(new retClass('200','注册成功',true))\r\n});\r\n\r\nrouter.post('/login',\r\n    passport.authenticate('local.login',{\r\n        failureFlash:true\r\n    }),function(req,res){\r\n        res.json(new retClass('200','登录成功',true))\r\n});\r\nmodule.exports = router;","const admin = require('./admin')\r\nvar express = require('express')\r\nvar router = express.Router()\r\nfunction ensureAuthenticated(req, res, next) {\r\n  if (req.isAuthenticated()) {\r\n    return next();\r\n  } else {\r\n    res.redirect('/index.html#/admin/login')\r\n  }\r\n}\r\nrouter.get('/',function(req,res){\r\n  res.redirect('/apidoc/index.html');\r\n});\r\nmodule.exports = function(app) {\r\n  app.use('/', router);\r\n  // app.use('/admin', admin);\r\n}\r\n","var express = require('express');\r\nvar path = require('path');\r\nvar favicon = require('serve-favicon');\r\nvar logger = require('morgan');\r\nvar cookieParser = require('cookie-parser');\r\nvar bodyParser = require('body-parser');\r\nvar session = require('express-session');\r\nvar flash = require('connect-flash');\r\nvar validator = require('express-validator');\r\nvar MongoStore = require('connect-mongo')(session);\r\nvar mongoose = require('mongoose');\r\nvar passport = require('./config/passport.config');\r\nvar routes = require('./apis/index');\r\nvar methodOverride = require('method-override');\r\nvar multer = require('multer');\r\nvar errorHandler = require('errorhandler'); \r\nvar log4js = require('log4js');\r\n\r\n\r\nvar app = express();\r\n\r\n\r\nlog4js.configure({\r\n  appenders: {\r\n    console: {\r\n      type: 'console'\r\n    },\r\n    menu: {\r\n      type: 'file', //文件输出\r\n      filename: 'logs/access.log',\r\n      replaceConsole: true\r\n    }  \r\n  },\r\n  categories: {\r\n    default: {\r\n      appenders: ['menu'],\r\n      level: 'info'\r\n    }\r\n  }\r\n});\r\n\r\nvar logger = log4js.getLogger('share');\r\napp.use(log4js.connectLogger(logger, {level:log4js.levels.INFO}));\r\n\r\n// override是为了改变表单提交get/post的请求以适应接口，比如put\r\napp.use(methodOverride());\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.urlencoded({ extended: false }));\r\napp.use(cookieParser())\r\napp.use(validator());\r\napp.use(session({\r\n  secret: 'share4mongodb',\r\n  resave: false,\r\n  saveUninitialized: false,\r\n  store:new MongoStore({\r\n      mongooseConnection:mongoose.connection\r\n  }),\r\n  cookie:{maxAge:180*60*1000} //store保存时间\r\n}));\r\n//对session操作的模块，应在session实例下面\r\napp.use(passport.initialize());\r\napp.use(passport.session());\r\napp.use(flash());\r\nvar options = {\r\n  dotfiles: 'ignore',\r\n  etag: false,\r\n  extensions: ['htm', 'html'],\r\n  index: false,\r\n  maxAge: '1d',\r\n  redirect: false,\r\n  setHeaders: function (res, path, stat) {\r\n    res.set('x-timestamp', Date.now());\r\n  }\r\n}\r\napp.use('/', express.static(path.join(__dirname, '../public'),options));\r\n// 路由配置\r\nroutes(app);\r\n// 错误处理中间件应当在路由加载之后才能加载\r\nif ('development' == app.get('env')) {\r\n  app.use(errorHandler());\r\n}\r\nmodule.exports = app","// #!/usr/bin/env node\n\n/**\n * Module dependencies.\n */\n\nvar app = require('../app');\nvar debug = require('debug')('init:server');\nvar http = require('http');\n\n/**\n * Get port from environment and store in Express.\n */\n\nvar port = normalizePort(process.env.PORT || '3000');\napp.set('port', port);\n\n/**\n * Create HTTP server.\n */\n\nvar server = http.createServer(app);\n\n/**\n * Listen on provided port, on all network interfaces.\n */\n\nserver.listen(port);\nserver.on('error', onError);\nserver.on('listening', onListening);\n\n/**\n * Normalize a port into a number, string, or false.\n */\n\nfunction normalizePort(val) {\n  var port = parseInt(val, 10);\n\n  if (isNaN(port)) {\n    // named pipe\n    return val;\n  }\n\n  if (port >= 0) {\n    // port number\n    return port;\n  }\n\n  return false;\n}\n\n/**\n * Event listener for HTTP server \"error\" event.\n */\n\nfunction onError(error) {\n  if (error.syscall !== 'listen') {\n    throw error;\n  }\n\n  var bind = typeof port === 'string'\n    ? 'Pipe ' + port\n    : 'Port ' + port;\n\n  // handle specific listen errors with friendly messages\n  switch (error.code) {\n    case 'EACCES':\n      console.error(bind + ' requires elevated privileges');\n      process.exit(1);\n      break;\n    case 'EADDRINUSE':\n      console.error(bind + ' is already in use');\n      process.exit(1);\n      break;\n    default:\n      throw error;\n  }\n}\n\n/**\n * Event listener for HTTP server \"listening\" event.\n */\n\nfunction onListening() {\n  var addr = server.address();\n  var bind = typeof addr === 'string'\n    ? 'pipe ' + addr\n    : 'port ' + addr.port;\n  debug('Listening on ' + bind);\n}\n","var passport = require('passport');\r\n\r\nvar User = require(\"../models/user.js\");\r\nvar localStategy = require('passport-local').Strategy;\r\n\r\n\r\npassport.serializeUser(function(user, done) {\r\n    done(null, user.id);\r\n});                           \r\n\r\n\r\npassport.deserializeUser(function(id, done) {\r\n    User.findById(id, function(err, user) {\r\n        done(err, user);\r\n    });\r\n});\r\n\r\npassport.use('local.signup',new localStategy({\r\n        usernameField:'username',\r\n        passwordField:'password',\r\n        passReqToCallback:true  //此处为true，下面函数的参数才能有req\r\n    },function(req,user,password,done){\r\n        User.findOne({'username':user},function(err,user){\r\n            if(err){\r\n                return done(err);\r\n            }\r\n            if(user){\r\n                return done(null,false,{message:\"此名称已经被注册\"});\r\n            }\r\n            var newUser = new User();\r\n            newUser.username = user;\r\n            newUser.password = newUser.encryptPassword(password);\r\n            newUser.save(function(err,result){\r\n                if(err){\r\n                    return done(err);\r\n                }\r\n                return done(null,newUser);\r\n            });\r\n        });\r\n}));\r\n\r\n\r\n\r\npassport.use('local.login',new localStategy({\r\n    usernameField:'username',\r\n    passwordField:'password',\r\n    passReqToCallback:true  //此处为true，下面函数的参数才能有req\r\n},function(req,user,password,done){\r\n    User.findOne({'username':user},function(err,user){\r\n        if(err){\r\n            return done(err);\r\n        }\r\n        if(!user){\r\n            return done(null,false,{message:\"用户名错误!\"});\r\n        }\r\n        if(!user.validPassword(password)){\r\n            return done(null,false,{message:\"密码错误!\"});\r\n        }\r\n        return done(null,user);\r\n    });\r\n}));\r\n\r\nmodule.exports = passport\r\n","//定义类\r\nexport default class {\r\n  constructor(x, y, z) {\r\n    this.retCode = x;\r\n    this.retMes = y;\r\n    this.ret = z;\r\n  }\r\n}","// var mongoose = require('../config/mongodb.config');\r\n// var bcrypt = require('bcrypt-nodejs');\r\n\r\n// var schema = mongoose.Schema;\r\n\r\n// var userSchema = new schema({\r\n//     username: { type: String, required: true },\r\n//     password: { type: String, required: true }\r\n// });\r\n// userSchema.methods.encryptPassword = function(password){\r\n//     return bcrypt.hashSync(password, bcrypt.genSaltSync(5), null);\r\n// };\r\n\r\n// userSchema.methods.validPassword = function(password){\r\n//     return bcrypt.compareSync(password, this.password);\r\n// };\r\n\r\n// module.exports = mongoose.model('user', userSchema);","module.exports = require(\"body-parser\");","module.exports = require(\"connect-flash\");","module.exports = require(\"connect-mongo\");","module.exports = require(\"cookie-parser\");","module.exports = require(\"debug\");","module.exports = require(\"errorhandler\");","module.exports = require(\"express\");","module.exports = require(\"express-session\");","module.exports = require(\"express-validator\");","module.exports = require(\"http\");","module.exports = require(\"log4js\");","module.exports = require(\"method-override\");","module.exports = require(\"mongoose\");","module.exports = require(\"morgan\");","module.exports = require(\"multer\");","module.exports = require(\"passport\");","module.exports = require(\"passport-local\");","module.exports = require(\"path\");","module.exports = require(\"serve-favicon\");"],"sourceRoot":""}